## Point of sale scale simulator - Arduino sketch

This is the Arduino sketch for a simulator of a Weigh-Tronix scale using the SCP-01 serial communications protocol.

The basics of the protocol is for the host application sends a one letter command followed by a carriage return and
the scale responds with a text message whose format varies depending on the command request sent.

The Arduino sketch is designed to run on an Arduino communicating with the host application through the serial USB
communication. This means that the serial port that is used for debugging is instead used by the host application.

A sample host application is also provided as a Visual Studio 2019 console application. The console application has 
a simple menu of commands which allows the Arduino simulator to be exercised.

## User interface with the membrane matrix keypad

In order to provide a simple user interface to modify the measurement and status data of the messages generated by the Arduino sketch, I allow the
use of a membrane keypad to be used to modify the weight reported, the units of weight reported, and several of the status indicators. Using the
membrane keypad allows for the data and status to be modified while the simulator is in use and the serial communications is being used by the
point of sale application and unavailable to any other application. Plus it was kind of a cool thing to add.

This sketch and the test application have been tested using the Elegoo UNO R3 Project Complete Starter Kit with Arduino Uno. The membrane keypad
I used for my testing was the one from that kit which contained the digits 0 through 9 as well as the letters A through D along with the star
and the pound sign.

I had to add the KeyPad.cpp and KeyPad.h files from the CD accompanying the Elegoo kit and used the membrane matrix keypad from the kit.

The user interface is as follows.

To change the simulated weight amount press the star key (*) to zero out the weight and then press the digits 0 through 9 to enter a weight
as dddd.dd so the first four digits entered are used for the most significant part of the weight, the dddd, and the second two digits are
used for the least significant part of the weight, the .dd, as the decimal point is assummed to be placed after the fourth digit entered.

To change the units of measurements between pounds (lb) and kilograms (kg) press the pound sign key (#).

To change some of the status byte 1 indicators press the letter A key then press a single digit key between 0 through 3 which results in a
binary number of 0, 01, 10, or 11 setting bits 0  (scale in motion or not) and 1 (scale at zero or not) of the first status byte.

To change some of the status byte 2 indicators press the letter A key then press a single digit key between 0 through 3 which results in a
binary number of 0, 01, 10, or 11 setting bits 0  (under capacity or not) and 1 (over capacity or not) of the second status byte.

## Details of the scale SCP-01 protocol

For details of the protocol see Weight-Tronix SCP-01 document 8408-14788-01, Serial Communications Protocol SCP -01 (NCI Standard, and 3825).

The mandatory commands are documented in the comments at the beginning of the sketch.

Avery Weigh-Tronix provides a PDF of the SCP-01 protocol specification at https://www.averyweigh-tronix.com/globalassets/products/postal-scales/postal-software-downloads-and-drivers/nci-protocol-serial-rs-232/wtcomm-activex-control/document-3--nci-standard.pdf

The basics are in comments in the Arduino sketch and replicated below:

      * Key to symbols used in the message descriptions following:
      *     <ETX> End of Text character (0x03).
      *     <LF>  Line Feed character (0x0A).
      *     <CR>  Carriage Return character (0x0D).
      *     <SP>  Space (0x20).
      *     x     Weight characters from display including minus sign and out-of range characters.
      *     c     Message/menu (ie non-weight) characters from display.
      *     hh... Two or more status bytes.
      *     uu    Units of measure (lb, kg, oz, g, etc. using ANSI standard abbreviations).
      *
      * Name: Request weight
      *     Command:  W<CR>
      *     Response: Returns decimal weight (x1), units and status.
      *               <LF>xxxx.xxuu<CR><LF>hh...<CR><ETX>
      *               
      *               Returns lb-oz weight, units plus scale status.
      *               <LF>xxlb<SP>xx.xoz<CR><LF>hh...<CR><ETX>
      *               
      *               Returns contents of display (other than wt) with units and scale status.
      *               <LF>cccccccuu<CR><LF>hh...<CR><ETX
      * 
      * Name: Change units of measure
      *     Command:  U<CR>
      *     Response: Changes units of measure, returns new units and scale status.
      *               <LF>uu<CR><LF>hh...<CR><ETX>
      *               
      * Name: Request status
      *     Command:  S<CR>
      *     Response: Returns scale status.
      *               <LF>hh...<CR><ETX>
      *               
      *               Bit 0 is the least significant bit in the byte while bit 7 is the most significant bit.
      *               Bit   Status Byte 1        Status Byte 2             Status Byte 3 (opt)
      *                0    1 = Scale in motion   1 = Under capacity         00 = Low range
      *                     0 = Stable            0 = Not under capacity     01 = (undefined)
      *                                                                      10 = (undefined)
      *                1    1 = Scale at zero     1 = Over capacity          11 = High range
      *                     0 = Not at zero       0 = Not over capacity
      *                     
      *                2    1 = RAM error         1 = ROM error               1 = Net weight
      *                     0 = RAM okay          0 = ROM okay                0 = Gross weight
      *                     
      *                3    1 = EEPROM error      1 = Faulty calibration      1 = Initial zero error
      *                     0 = EEPROM okay       0 = Calibration okay        0 = Initial zero OK
      *                     
      *                4    Always 1              Always 1                    Always 1
      *                
      *                5    Always 1              Always 1                    Always 1
      *                
      *                6    Always 0              1 = Byte follows            1 = Byte follows
      *                                           0 = Last byte               0 = Last byte
      *                                           
      *                7    Parity                Parity                      Parity
      *                
      *                
      * Name: unrecognized command
      *     Command:  all others
      *     Response: Unrecognized command
      *               <LF>?<CR><ETX>
      *     
